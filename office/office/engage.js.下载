!function(){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){throw new Error('"'+e+'" is read-only')}var l=("https:"==location.protocol?"https://":"http://")+"collect.ptengine.cn/egg";function d(e){var t=e.method,n=e.data,r=e.url,a=e.callback;t=t||"GET";var i=new XMLHttpRequest;"withCredentials"in i?i.open(t,r,!0):"undefined"!=typeof XDomainRequest?(s("xhr"),(i=new XDomainRequest).open(t,r)):(s("xhr"),i=null),i&&(a&&(i.onreadystatechange=function(){4!==i.readyState||200!==i.status&&201!==i.status||a(i.responseText)}),i.send(n))}function f(e,t,n){if(1===arguments.length){var r,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(r=document.cookie.match(a))?unescape(r[2]):null}if(1<arguments.length){var i,o="";if(n.expires&&("number"==typeof n.expires||n.expires.toUTCString))"number"==typeof n.expires?(i=new Date).setTime(i.getTime()+24*n.expires*60*60*1e3):i=n.expires,o="; expires="+i.toUTCString();document.cookie=e+"="+t+o+"; path=/;"}}function g(e,t){try{var n=f("pt_"+e);return-1!=n.indexOf(t)?n.split(t+"=")[1].split("&")[0]:""}catch(r){console.log(r)}}function p(e){return 1==function t(e){return+g(e=e||localStorage.getItem("PTSID"),"vn")}(e=e||localStorage.getItem("PTSID"))}function U(e){return g(e=e||localStorage.getItem("PTSID"),"uid")}function h(){try{var e=navigator.userAgent;return e?function r(){var e=navigator.platform.toLowerCase();if(-1<e.indexOf("win"))return!0;for(var t=["mac68k","macppc","macintosh","macintel"],n=0;n<t.length;n++)if(e==t[n])return!0;return!1}()||function a(e){for(var t=["AIX","Amiga","BeOS","DragonFly","FreeBSD","GNU","Haiku","HP-UX","IRIX","Joli","Java","Macintosh","Minix","MorphOS","NetBSD","OpenBSD","PClinuxOS","QNX x86pc","SunOS","Ubuntu","Mint","Red Hat","Slackware","SUSE","PCLinuxOS","Debian","Fedora","CentOS","Vine","Arch Linux","Gentoo","Kanotix","Mandriva"],n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1}(e)?function i(e){for(var t=["Android","AROS","Bada","BlackBerry","Chromium","CrOS","Danger Hiptop","Inferno","iPhone","iPad","iPod","Nintendo DS","Nintendo Wii","Palm OS","PLAYSTATION","Syllable","SymbOS","Symbian","Tizen","webOS","WebTV","Windows CE","Windows Mobile","Windows Phone","Xbox"],n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1}(e)?3:e.match(/.*MSIE.*Windows NT 6\.2;.*Touch\).*/)?4:2:-1<e.indexOf("iPad")||1e3<=Math.min(function n(){try{var e=window.screen.width;return e?isNaN(parseInt(e,10))?0:parseInt(e,10):0}catch(t){return 0}}(),window.screen.height)?4:1:0}catch(t){return 0}}function v(n){if("string"==typeof n){return["?","^","$","*","+","(",")","|"].map(function(e){var t=new RegExp("(\\"+e+")","g");n=n.replace(t,"\\$1")}),n}}function m(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?decodeURIComponent(n[2]):null}function y(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function w(e){var t;if(e){var n=window.PT_ENGAGE_IN_DEBUG?"engager_debug":"engager",r=JSON.parse(localStorage.getItem(n)||"{}");r.hasOwnProperty(e)&&(t=r[e])}return t}function V(e,t){"true"==(localStorage.getItem("enableLog")||"false")&&console.log(e||"",t||"")}function b(){return/MicroMessenger/i.test(navigator.userAgent)}function q(e){for(var t=new Array,n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.join("")}var e=function(){function e(){a(this,e),this.timezone=""}return i(e,[{key:"setTimeZone",value:function(e){this.timezone=e}},{key:"getProfileTimeStamp",value:function(){var e=0;if(this.timezone.trim()){var t,n=60*(new Date).getTimezoneOffset()*1e3*-1,r=this.timezone.replace(":"," ").split(" ");2==r.length&&(t=60*Number(r[0].slice(1))*60*1e3+60*Number(r[1])*1e3,t=Number(r[0].slice(0,1)+t));var a=n-t;e=Date.now()-a}return e}}]),e}(),x=new(function(){function e(){a(this,e),this.cache={}}return i(e,[{key:"get",value:function(e){return this.cache[e]}},{key:"set",value:function(e,t){this.cache[e]=t}}]),e}()),J=new e;function t(){this.middlewares=[],this.events={}}t.prototype.on=function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},t.prototype.emit=function(e,t){var n=this.events[e];if(!n||0===n.length)return!1;for(var r,a=0;r=n[a++];)r.call(this,t)},t.prototype.use=function(e){return this.middlewares.push(e),this},t.prototype.init=function(){var e="https:"==location.protocol?"https://":"http://",t=document.createElement("script"),n=localStorage.getItem("PTSID");t.type="text/javascript",t.async=!1,t.charset="UTF-8",t.src=e+"pteengagejs.ptengine.cn/c."+n+".v2.js?ts="+(new Date).getTime(),document.getElementsByTagName("head")[0].appendChild(t),f("pt_engage_helper","1",{expires:5/86400}),window.$$__pt_engage_$=this},t.prototype.run=function(e){if(!e)return!1;var t=this,n={window:window,setting:e,engager:t},r=0;!function a(){var e=t.middlewares[r++];e&&e(n,a)}()};var k=function(){function e(){a(this,e)}return i(e,[{key:"validate",value:function(){throw{name:"ImplementError",message:"validate method should be implement by "+this.constructor.name}}}]),e}(),T=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){switch(t){case"Match":return e}return!1}}]),t}(),S=function(e){function t(){var e;return a(this,t),(e=u(this,c(t).call(this))).currentTerminalType=h(),e}return o(t,k),i(t,[{key:"validate",value:function(e,t){switch(t){case"==":return this.currentTerminalType==e;case"!=":return this.currentTerminalType!=e}return!1}}]),t}(),E=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=p()?"NV":"RV";switch(t){case"==":return n==e;case"!=":return n!=e}return!1}}]),t}(),C=function(e){function n(e){var t;return a(this,n),(t=u(this,c(n).call(this))).type=e,t}return o(n,k),i(n,[{key:"validate",value:function(e,t){var n=this.type,r=m(n)||"";if(!r){var a=n.toLowerCase().split("utm");r=m(n=0<a.length&&"utm".concat(a).replace(",","_"))||""}switch(t){case"==":return r==e;case"!=":return r!=e;case"Rex":return new RegExp(e).test(r);case"[()]":return-1!=r.indexOf(e);case"[(":return new RegExp("^"+e).test(r);case")]":return new RegExp(e+"$").test(r)}return!1}}]),n}(),_=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n,r=document.referrer;switch(t){case"==":n=r==e;break;case"Rex":n=new RegExp(e).test(r);break;case"[()]":n=-1!=r.indexOf(e);break;case"[(":n=new RegExp("^"+r).test(e);break;case")]":n=new RegExp(r+"$").test(e);break;default:n=!1}return n}}]),t}(),O=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n,r=location.href;switch(t){case"==":n=r==e||r.slice(0,-1)==e;break;case"Rex":n=new RegExp(e).test(r);break;case"[()]":n=-1!=r.indexOf(e);break;case"![()]":n=-1==r.indexOf(e);break;case"[(":n=new RegExp("^"+v(e)).test(r);break;case")]":n=new RegExp(v(e)+"$").test(r);break;default:n=!1}return n}}]),t}(),N=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=!1;try{var r=location.href;Array.isArray(t)||(t=JSON.parse(t));for(var a=0,i=t.length;a<i;a++){var o=t[a];switch(o.pattern){case 2:n=new RegExp(o.url).test(r);break;case 3:n=new RegExp("^"+o.url).test(r);break;case 4:n=new RegExp(o.url+"$").test(r);break;case 5:n=o.url==r;break;case 8:n=-1<r.indexOf(o.url)}}}catch(c){}return n}}]),t}(),I=function(e){function t(){var e;return a(this,t),(e=u(this,c(t).call(this))).currentTerminalType=h(),e}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=e.context,r=n.engager,a=e.current;e=e.value;var i=!1;"=="==t&&e&&("2"==this.currentTerminalType&&y(document,"mousemove",function(e){f("pt_engage_helper")||e.clientY<12&&!b()&&r.emit("next",{context:n,current:a})}),"1"!=this.currentTerminalType&&"4"!=this.currentTerminalType||b()||(history.replaceState("beforeunload",null,null),history.pushState("back",null,null),window.addEventListener&&window.addEventListener("popstate",function(e){"beforeunload"===e.state&&(i||(i=!0,r.emit("next",{context:n,current:a})))})))}}]),t}(),A=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=e.context,r=n.engager,a=e.current;switch(t){case"==":setTimeout(function(){r.emit("next",{context:n,current:a})},1e3*+e.value);break;case">=":setTimeout(function(){r.emit("next",{context:n,current:a})},1e3*(+e.value+1))}}}]),t}(),D=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=e.context,r=n.engager,a=e.current;console.log("user stop action",e);var i=e.value,o=null;o=setTimeout(function(){r.emit("next",{context:n,current:a})},1e3*+i),y(document,"scroll",function(){o&&(clearTimeout(o),o=null),o=setTimeout(function(){r.emit("next",{context:n,current:a})},1e3*+i)}),y(document,"click",function(){o&&(clearTimeout(o),o=null),o=setTimeout(function(){r.emit("next",{context:n,current:a})},1e3*+i)})}}]),t}(),P=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(r,e){var a=r.context,i=a.current,o=a.engager,c=(r=+r.value.replace("%",""),!1);y(document,"scroll",function(){console.log("event Scroll match"),setTimeout(function(){var e=parseInt(document.body.scrollHeight,10),t=document.documentElement.scrollTop||window.pageYOffset;isNaN(t)&&(screenTop=0);var n=(parseFloat(t)+parseInt(document.documentElement.clientHeight,10))/e*100;(Math.abs(n-r)<=2||r<=n)&&!c&&(c=!0,o.emit("next",{context:a,current:i}))},50)})}}]),t}(),L=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=e.context,r=n.current,a=n.engager,i=r.engagerId;a.on("showEngagement.".concat(i),function(){a.emit("next",{context:n,current:r})})}}]),t}(),R=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=e.value,r=e.context.current;switch(t){case">":+JSON.parse(w(r.exp_id)||"{}").seenTimes>=n?r.goNext=!1:r.goNext=!0}}}]),t}(),M=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=e.value,r=e.context.current,a=JSON.parse(w(r.exp_id)||"{}");a.hasClosed&&+a.hasClosed>=n?r.goNext=!1:r.goNext=!0}}]),t}(),j=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=e.context,r=e.value,a=n.current,i=JSON.parse(w(a.exp_id)||"{}");switch(t){case"==":!!i.hasClicked==r?a.goNext=!1:a.goNext=!0;break;case"!=":!!i.hasClicked!=r?a.goNext=!0:a.goNext=!1}}}]),t}(),B=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n,r=J.getProfileTimeStamp(),a=r||Date.now();if(a=String(a).slice(0,-3),Array.isArray(e)||(e=[e]),0<e.length){var i=e[0]?a-e[0]:"",o=e[1]?e[1]-a:"";n=o?0<=o&&0<=i:i&&0<=i}else n=!0;return n}}]),t}(),$=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=J.getProfileTimeStamp(),r=(n?new Date(n):new Date).getDay();return Array.isArray(e)||(e=[e]),0==e.length||7==e.length||-1<e.indexOf(r)}}]),t}(),z=function(e){function t(){return a(this,t),u(this,c(t).call(this))}return o(t,k),i(t,[{key:"validate",value:function(e,t){var n=J.getProfileTimeStamp(),r=n?new Date(n):new Date,a=r.getHours(),i=(a=a<10?"0"+a:a)+":"+r.getMinutes();Array.isArray(e)||(e=[e]);var o=!1;if(0<e.length){var c=e[0],u=e[1];c<=i&&i<=u&&(o=!0)}else o=!0;return o}}]),t}();function H(e){var t=x.get(e);if(!t){switch(e){case"TerminalType":t=new S;break;case"VisitType":t=new E;break;case"utmCampaign":case"utmSource":case"utmMedium":case"utmContent":case"utmTerm":t=new C(e);break;case"EntryPage":t=new _;break;case"URL":t=new O;break;case"PageGroup":t=new N;break;case"UserBlur":t=new I;break;case"UserStay":t=new A;break;case"UserStop":t=new D;break;case"ScrollMatch":t=new P;break;case"ShownByJs":t=new L;break;case"UtmParameter":t=new C;break;case"ClickButton":t=new j;break;case"SeenTimes":t=new R;break;case"CloseTimes":t=new M;break;case"Dater":t=new B;break;case"Week":t=new $;break;case"Time":t=new z;break;case"AsyncUserProps":t=new T}x.set(e,t)}return t}var G=function(){function r(e,t,n){a(this,r),this.value=e,this.condition=t,this.validator=n}return i(r,[{key:"setValue",value:function(e){this.value=e}},{key:"setCondition",value:function(e){this.condition=e}},{key:"setValidator",value:function(e){this.validator=e}},{key:"run",value:function(){var e;try{return this.validator.validate(this.value,this.condition)}catch(t){V(t.name,t.message),e=!1}return e}}]),r}();var X=function X(e,t){if(V("the value of configs is:",t),t&&Array.isArray(t))for(var n=function B(e,t,n){return new G(e,t,n)}(),r=0,a=t.length;r<a;r++){var i=t[r];if(i.audienceResult){for(var o=i.experiments,c=o.rate||i.rates,u=0,s=0,l=[],d=0,f=c.length;d<f;d++)l.push({min:100*s,max:100*(s+c[d])}),s+=c[d];var g=U(e.setting.sid);V("uid =",g);for(var p=q(g)%99,h=0,v=l.length;h<v;h++)if(p>=l[h].min&&p<l[h].max){u=h;break}V("local version",u),V(l),V("random number is"+p,"whione = "+u);var m=o.experiment?o.experiment[u]:o[u];m&&(e.current=m,e.current.engagerId=i.engageId);var y=e.current;y.when=y.config.when;var w=y.when;Array.isArray(w)||(w=[w]);var b=!1,x=!1;w[0]&&"URL"==w[0].type&&"![()]"==w[0].condition&&(b=x=!0);for(var k=0,T=w.length;k<T;k++){var S=w[k];if(S.type){if(n.setValue(S.value),n.setCondition(S.condition),n.setValidator(H(S.type)),b=x?b&&n.run():b||n.run(),V("current context ",e.current),V("validate value",n),x&&!b)break;if(!x&&b)break}}if(V("the result of validation",b),b){if(V("ready to validate the stopToDisplay condition",y),y.stopToDisplay=y.stopToDisplay||y.config.stop,y.stopToDisplay&&0<y.stopToDisplay.length){var E=y.stopToDisplay;console.log("stopToDisplayList",E);for(var C=0,_=E.length;C<_;C++){var O=E[C];if(n.setValue({value:O.value,current:e.current,context:e}),n.setCondition(O.condition),n.setValidator(H(O.type)),n.run(),!e.current.goNext){V("satisfied with stopToDisplay condition,stop to render engage");break}}}else e.current.goNext=!0;V("validate displayTime condition",y);var N=!0;if(y.displayTime=y.displayTime||y.config.schedule,y.timezone=y.timezone||y.config.timezone,y.displayTime&&0<y.displayTime.length){var I=y.displayTime,A=y.timezone||{};J.setTimeZone(""),!A.useVisitor&&J.setTimeZone(A.profile||""),Array.isArray(I)||(I=[I]);for(var D=0;D<I.length;D++){var P=I[D];if(n.setValue(P.value),n.setValidator(H(P.type)),V("the result of dispalyTime validation",n.run()),!n.run()){N=!1,V("not satisfied with dispalyTime condition",n);break}}}if(V("validate startToDisplay condition",y),N&&e.current.goNext)if(y.startToDisplay=y.startToDisplay||y.config.start,y.startToDisplay&&0<y.startToDisplay.length){var L=y.startToDisplay;Array.isArray(L)||(L=[L]);for(var R=0,M=L.length;R<M;R++){var j=L[R];n.setValue({value:j.value,current:e.current,context:e}),n.setCondition(j.condition),n.setValidator(H(j.type)),n.run(),V("delay to enter the render staged...")}}else V("enter the render staged immediate..."),e.engager.emit("next",e)}}}},W=function W(t,e){var n=Array.prototype.filter.call(e,function(e){return e.id==t});return n&&0<n.length?n[0]:null},F=function F(e,t){for(var n in e){var r=e[n];if(!r)break;var a=W(r.engageId,t);if(V("result = ",a),a){var i=a.audienceResult;r.audienceResult=i}}return V("async configs",e),e},Y=function Y(e,a,i){var t=e.setting.sid,n="https:"==location.protocol?"https://":"http://";if(t){var r=U(t),o=function c(e){return g(e=e||localStorage.getItem("PTSID"),"vid")}(t);d({url:"".concat(n,"engagematch.ptengine.cn/match"),method:"POST",data:JSON.stringify({uid:r,sid:t,vid:o}),callback:function(e){try{var t=JSON.parse(e);if(t.status&&"Success"==t.status){var n=F(a,t.result);i&&i(n)}}catch(r){V(r)}}})}};var Z="position",K="pos-center",Q="ptEngage",ee="pt_mask_",te=2147483647,ne="button-close",re="icon-close",ae=h(),ie=1,oe=function oe(e){var t=x.get(Z)||[],n=t.indexOf(e);-1!=n&&(t.splice(n,1),x.set(e,t))},ce=function ce(l,d,f){var g=d.current;y(l,"click",function(e){for(var n=(e=e||window.event).target||e.srcElement,r=["data-engage-action-click","data-engage-action-close"],t=!1,a="";a=n.getAttribute("data-engage-block"),!(t=function(){for(var e=0,t=r.length;e<t;e++)if(n.getAttribute(r[e]))return!0}())&&(n=n.parentNode),!t&&n!=l;);if(t){e.preventDefault();var i=n.tagName.toUpperCase(),o=n.textContent||i||"unknow target";if(n.parentNode&&"image"==n.parentNode.getAttribute("data-engage-block")){var c=n.querySelector("img");c&&(o=c.getAttribute("alt"))}if(a&&(a==re||a==ne)){we().removeChild(l),g.shouldCreateMaskLayer&&Te(g.engagerId),a==ne?(ge(d,g,"click",o),f&&"function"==typeof f&&f(g.exp_id)):ge(d,g,"close",o),V("has close"),f&&"function"==typeof f&&f(g.exp_id,"hasClosed");try{!g.currentTerminal.codeMode&&oe(g.currentTerminal.visualModel.widgetSettings.position)}catch(u){}return}if(ge(d,g,"click",o),n.href&&!/^javascript:(void\(0\))?;?$/.test(n.href))if("_blank"==n.target)try{window.open(n.href,"_blank")}catch(s){V("not support to use window.open",s)}else window.location.href=n.href;f&&"function"==typeof f&&f(g.exp_id)}})},ue=function ue(e,t){var n=2<arguments.length&&arguments[2]!==undefined&&arguments[2],r=e.current,a=n?r.currentTerminal.codeSync:r.currentTerminal.visualModel.widgetNodes,i=be(xe(r.engagerId));i.innerHTML=ye(a),we().appendChild(i),n&&pe(i);var o=r.currentTerminal;if(o){var c=o.visualModel.widgetSettings;c&&c.position==K&&(ke(r.engagerId),e.current.shouldCreateMaskLayer=!0);var u=i.querySelector('[data-engage-block="branding"]');if(u){var s=(u.href||"").replace(/(utm_source=)Customer-Site/,"$1"+location.hostname);u.setAttribute("href",s)}}ce(i,e,function(e){return fe(e,1<arguments.length&&arguments[1]!==undefined?arguments[1]:"hasClicked")}),ie=1;var l=i.querySelectorAll("img");Array.prototype.slice.call(l).forEach(function(e){y(e,"load",function(){e.style.opacity="1",e.style.visibility="visible"})}),t&&"function"==typeof t&&t()};function se(e){if("string"==typeof e||"number"==typeof e){if(-1!=e.indexOf("<")&&/<?\/[a-z]*>/.test(e)){var t=document.createElement("div");return t.innerHTML=e,t}return document.createTextNode(e)}var n,r;1==ie&&"a"==e.tag?(n=document.createElement("div"),(r=e.props).hasOwnProperty("href")&&delete r.href):(n=document.createElement(e.tag),r=e.props),ie++,function i(e,t){for(var n in t)e.setAttribute(n,t[n])}(n,r);var a=e.children;return a&&a.map(se).forEach(n.appendChild.bind(n)),n}var le=function le(e){var t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:function(){};e.current;return V("render control group"),t()};function de(e){V("running render dom...");var t=e.context||e;t.current=e.current;var n=t.current,r=function r(e,t){return function(){x.set(t.exp_id,t.exp_id),ge(e,t,"view"),fe(t.exp_id)}};if(n.controlGroup)x.get(n.exp_id)||(V("start to render control group version"),le(t,r(t,n)));else{V("start to render normal version");var a=n.terminal&&function u(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].type==e)return t[n];return t[0]}(ae,n.terminal),i=n.defaultOptions||a;if(!a||(n.currentTerminal=a).status)try{var o=n.currentTerminal.visualModel;if(o&&o.widgetSettings)if(n.currentTerminal.codeMode){if(!x.get(n.exp_id)){var c=n.currentTerminal.codeSync.html;c&&/data-engage-block/i.test(c)?ue(t,r(t,n),!0):he(t,r(t,n))}}else x.get(n.exp_id)||me(o.widgetSettings.position)&&ue(t,r(t,n));else n.currentTerminal.codeMode?x.get(n.exp_id)||he(t,r(t,n)):x.get(n.exp_id)||me(i.position||i.commonSync.position)&&function d(e,t){var n=e.current,r=n.currentTerminal.nodes,a=be(xe(n.engagerId)),i=we(),o=se(r);a.appendChild(o),i.appendChild(a);var c=n.currentTerminal;if(c){c.commonSync.position==K&&(ke(n.engagerId),e.current.shouldCreateMaskLayer=!0);var u=a.querySelector(".js-engage-promotion-branding,.engage-promotion__friendLink,.engage-friendLink");if(u)if(c.commonSync.branding){u.style.display="block";var s=(u.href||"").replace(/(utm_source=)Customer-Site/,"$1"+location.hostname);u.setAttribute("href",s)}else u.style.display="none"}ve(a,e,function(e){return fe(e,1<arguments.length&&arguments[1]!==undefined?arguments[1]:"hasClicked")}),ie=1;var l=a.querySelectorAll("img");Array.prototype.slice.call(l).forEach(function(e){y(e,"load",function(){e.style.opacity="1",e.style.visibility="visible"})}),t&&"function"==typeof t&&t()}(t,r(t,n))}catch(s){console.log(s)}}}function fe(e){var t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:"seenTimes",n=w(e);null==n?n={seenTimes:1,hasClosed:0,hasClicked:0}:(n=JSON.parse(n))[t]=Number(n[t])+1,function a(e,t){if(e){var n=window.PT_ENGAGE_IN_DEBUG?"engager_debug":"engager",r=JSON.parse(localStorage.getItem(n)||"{}");r[e]=t,localStorage.setItem(n,JSON.stringify(r))}}(e,JSON.stringify(n))}function ge(e,t){var n=2<arguments.length&&arguments[2]!==undefined?arguments[2]:"view",r=3<arguments.length?arguments[3]:undefined,a=e.setting.sid,i=t.engagerId,o=t.exp_id,c=t.variant||{},u=t.triggerCondition;r&&(c=function s(a){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},t=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){var t,n,r;t=a,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r})}return a}({},c,{target:r})),e.send(n,{sid:a,engagerId:i,engagerVerId:o,variant:c,triggerCondition:u})}function pe(e){Array.prototype.slice.call(e.querySelectorAll("script")).forEach(function(e){var t=document.createElement("script"),n="\n                try {\n                    (function(){".concat(e.innerHTML,"})();\n                } catch (error) {\n                    console.warn(error);\n                }");t.innerHTML=n;var r=document.getElementsByTagName("head")[0];r.appendChild(t),r.removeChild(t)})}function he(e,t){var n=e.current,r=be(xe(n.engagerId)),a=we();r.innerHTML=ye(n.currentTerminal.codeSync),a.appendChild(r),pe(r);var i=!!r.querySelector("[data-pt-showmask]");if(e.current.shouldCreateMaskLayer=i){ke(n.engagerId);var o=r.querySelector(".engage-promo__v-common");if(o)o.style.zIndex=te;else{var c=r.querySelector("[data-pt-engage-id]");c&&(c.style.zIndex=te)}}ve(r,e,function(e){return fe(e,1<arguments.length&&arguments[1]!==undefined?arguments[1]:"hasClicked")}),t&&"function"==typeof t&&t()}function ve(f,g,p){var h=g.current;y(f,"click",function(e){for(var t,n=(e=e||window.event).target||e.srcElement,r=["js-engage-interaction","js-engage-close","js-engage-promotion-close","js-engage-promotion-button","js-engage-promotion-image","js-engage-promotion-a"],a=!1,i=!1,o="",c=[];t=JSON.parse(n.getAttribute("data-pt-action")||"{}"),i="false"===(n.getAttribute("data-pt-status")||String(t.status)),o=n.getAttribute("data-pt-type")||String(t.type),c=n.className||n.classList.value,!(a=function(){for(var e=0,t=r.length;e<t;e++)if(-1!==c.indexOf(r[e]))return!0}())&&(n=n.parentNode),!a&&n!=f;);if(i)e.preventDefault();else if(a){e.preventDefault();var u=n.tagName.toUpperCase(),s=n.textContent||u||"unknow target";if(n.parentNode&&"image"==n.parentNode.getAttribute("data-engage-block")){var l=n.querySelector("img");l&&(s=l.getAttribute("alt"))}if("3"===o||-1!=c.indexOf("js-engage-close")||-1!=c.indexOf("js-engage-promotion-close"))return we().removeChild(f),h.shouldCreateMaskLayer&&Te(h.engagerId),"3"===o?(ge(g,h,"click",s),p&&"function"==typeof p&&p(h.exp_id)):ge(g,h,"close",s),void(p&&"function"==typeof p&&p(h.exp_id,"hasClosed"));if(ge(g,h,"click",s),n.href&&!/^javascript:(void\(0\))?;?$/.test(n.href))if("_blank"==n.target)try{window.open(n.href,"_blank")}catch(d){V("not support to use window.open",d)}else window.location.href=n.href;p&&"function"==typeof p&&p(h.exp_id)}})}function me(e){var t,n=x.get(Z)||[];return(t=1==ae?!n.length:!(-1<n.indexOf(e)))&&(n[n.length]=e,x.set(Z,n)),t}function ye(e){var t=e.css,n=e.html;return function r(e){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}(t),n}function we(){var e=document.getElementById(Q);return e||((e=document.createElement("div")).setAttribute("id",Q),document.body.appendChild(e)),e}function be(e){var t=document.getElementById(e);return t||(t=document.createElement("div")).setAttribute("id",e),t}function xe(e){return"engage_"+e}function ke(e){var t=document.querySelector(".engage-layer");t||(t=document.createElement("div")).classList.add("engage-layer");var n="".concat(ee).concat(e),r=document.getElementsByTagName("html")[0];r.classList.add("engage-layer-open"),r.classList.add(n);var a=document.body;a.classList.add("engage-layer-open"),a.classList.add(n),a.appendChild(t)}function Te(e){var t=document.querySelector(".engage-layer");if(t){var n="".concat(ee).concat(e),r=["engage-layer-open",n],a=document.getElementsByTagName("html")[0],i=document.body;Array.prototype.slice.call(document.body.classList).filter(function(e){return"engage-layer-open"==e||/^pt_mask_/.test(e)}).reverse().join("")==r.reverse().join("")?(i.removeChild(t),r.forEach(function(e){a.classList.remove(e),i.classList.remove(e)})):(a.classList.remove(n),i.classList.remove(n))}}var Se=function(e){!function t(){var e=document.getElementById(Q);e&&document.body.removeChild(e)}(),e.on("next",function(e){V("call render..."),function t(e){V("running render module"),V(e),V("render finished,all over"),de(e)}(e)})},Ee="__pt__engager__common__style",Ce=function(e){e.on("next",function(){if(!document.getElementById(Ee)){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.id=Ee,e.href=("https:"==location.protocol?"https://":"http://")+"pteengagecss.ptengine.cn/styles/engager.css",document.getElementsByTagName("head")[0].appendChild(e)}!function t(){var e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(".engage-promotion-wrap{display:none}")),document.getElementsByTagName("head")[0].appendChild(e)}()})};function _e(e,t){window.CustomEvent=window.CustomEvent||function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:undefined};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}return e.prototype=window.Event.prototype,e}();try{return new window.CustomEvent(e,t)}catch(n){return null}}function Oe(t){return function(){if(0!==arguments.length)switch(arguments[0]){case"showEngagement":var e=arguments[1];!function a(e,t){if(t){var n=e.engager,r=e.setting;Array.isArray(r)||(r=(e.setting||{}).configs||[]),r.filter(function(e){return e.engageId==t}).length<=0?V("the target engage is not Found"):n.emit("showEngagement.".concat(t))}else V("the engageId param is required.")}(t,e)}else V("the api need event arguments")}}var Ne=new t;localStorage.removeItem("engager_debug"),Ne.use(function Ie(e,t){V("running sender module"),V("mounted the send to contextï¼Œsend to collect package"),e.send=function(e,t){var n=t.sid,r=t.engagerId,a=t.engagerVerId,i=t.variant||{},o=t.triggerCondition;"click"==e&&(o="click");var c=localStorage.getItem("PT_ID_"+n);if(c){var u=c.split(".");!function s(e){return d({method:"POST",data:encodeURIComponent(JSON.stringify(e)),url:l})}({sid:n=u[0],uid:u[1],vid:u[2],pid:u[3],peid:u[4],ts:(new Date).getTime(),engagerId:r,engagerVerId:a,triggerCondition:o,engagerType:e,variant:i})}},V("init sender finished,ready to enter trigger staged..."),t()}).use(function Ae(t,e){if(window.localStorage){V("ready to enter triger staged",t),localStorage.setItem("PTSID",t.setting.sid);var n=(t.setting||{}).configs||[];Y(t,n,function(e){return X(t,e)}),e()}else V("not support to use localstorage")}).use(function De(e,t){try{var n=new _e("ptEventReady",{bubbles:!1,cancelable:!1,detail:{}});n&&(window.Ptengine=Oe(e),document.dispatchEvent&&"function"==typeof document.dispatchEvent?document.dispatchEvent(n):document.fireEvent&&"function"==typeof document.fireEvent&&document.fireEvent(n),window.ptEngage=e.engager)}catch(r){console.log("catch phase invoke !")}t()}),Ce(Ne),Se(Ne),Ne.init()}();
//# sourceMappingURL=http://localhost:8080/dest/bundle.js.map