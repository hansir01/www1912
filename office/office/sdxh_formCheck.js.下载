//咨询通道
var sdxh_talk_mode_fun = function () {};
if (document.cookie.indexOf("sdxh_talk_clo=") < 0)
    switch ((window.sdxh_talk_mode == undefined ? 1 : sdxh_talk_mode)) { //判断咨询是否开启，判断为开启后，再判断咨询方案
        case 2:
        case 3:
        case 1: //商务通
            document.write("<script src=\"https://dft.zoosnet.net/js/lsjs.aspx?siteid=DFT39282681&float=1&lng=cn\"></script>");
            sdxh_talk_mode_fun = function (elem) {
                elem == undefined ? $("<a></a>") : elem;
                var sdxh_talk_text = $(elem).data("sdxh_talk_text"); //前台显示参数
                sdxh_talk_text = sdxh_talk_text == undefined ? "" : sdxh_talk_text.trim();
                var sdxh_talk_alt = $(elem).data("sdxh_talk_alt"); //后台说明参数
                sdxh_talk_alt = sdxh_talk_alt == undefined ? "" : sdxh_talk_alt.trim();
                sdxh_talk_alt = ((sdxh_talk_text != "" && sdxh_talk_alt.indexOf("sdxh_talk") < 0) ? "sdxh_talk_autosend|" : "") + sdxh_talk_alt;
                if (!(typeof LR_pm010 == "undefined" ? 1 : LR_pm010)) {
                    var LR_miniframe = window.frames['LR_miniframe'];
                    if (LR_miniframe != undefined) {
                        var cmd = {};
                        cmd.a = 'send';
                        cmd.b = sdxh_talk_text;
                        LR_miniframe.postMessage(cmd, '*');
                    } else
                        LR_msg = sdxh_talk_text;
                } else
                    LR_msg = sdxh_talk_text;
                LR_HideInvite();
                openZoosUrl('chatwin', '&e=' + encodeURI(sdxh_talk_alt));
            }
            break;
        case 4: //商务通方案2
            sdxh_talk_mode_fun = function () {
                window.location.href = 'https://dft.zoosnet.net/LR/Chatpre.aspx?id=DFT39282681&lng=cn&e=sdxhSeoPage';
            };
            break;
        default:
            sdxh_talk_mode_fun = function () {
                alert("警告！\n\n    咨询方案选择错误，请及时调整！");
            };
    }
else
    sdxh_talk_mode_fun = function (elem) {
        elem == undefined ? $("<a></a>") : elem;
        alert("咨询已经关闭，请点击右上角开启！\n\n前台对话：" + $(elem).data("sdxh_talk_text") + "\n后台说明：" + $(elem).data("sdxh_talk_alt"));
    };

var sdxh_zxUrl_elem = $('.zxUrl');
sdxh_zxUrl_elem.click(function () {
    window._hmt == undefined ? console.log("百度统计被屏蔽！") : _hmt.push(['_trackPageview', '/about/talk/']);
    sdxh_talk_mode_fun(this);
});

//免费电话
function sdxh_freetel(elem) {
    if ($(elem).val() == "") {
        alert("请输入手机号码");
        $(elem).focus();
        return false;
    } else if (!(/^1[3-5|7-9][0-9]{9}$/.test($(elem).val()))) {
        alert("请输入正确的手机号码！");
        if (isNaN($(elem).val()))
            $(elem).val("");
        $(elem).focus();
        return false;
    }
    $("body").append('<iframe style="display:none" src="https://tel.kuaishang.cn/calld.php?sid=2019061322&did=1012945&tel=' + $(elem).val() + '&fromurl=' + encodeURIComponent(window.location.href) + '&time=' + Math.random() + '" ></iframe>')
}

//表单提交
function sdxh_formCheck(elem) {
    var sdxh_formtoswt = typeof LiveReceptionCode_isonline != 'undefined' && LiveReceptionCode_isonline == 1;

    function add(nam, valu, force) {
        force = force == undefined ? false : force;
        var namvalu = $(elem).find("input[name='" + nam + "']:last").val();
        if (namvalu == undefined)
            $(elem).append("<input name='" + nam + "' type='hidden' value='" + valu + "'>");
        else if (namvalu == "" || force)
            $(elem).find("input[name='" + nam + "']:last").val(valu);
        return;
    }

    if (elem.mycall == undefined) {
        alert("表单不完整！");
        return false;
    }

    if ($(elem).find("input[name='name']").length > 0 && !$(elem).find("input[name='name']").is(':hidden'))
        if ($(elem).find("input[name='name']").val() == "") {
            alert("请输入姓名");
            $(elem).find("input[name='name']").focus();
            return false;
        } else if ($(elem).find("input[name='name']").val().indexOf("姓名") != -1 || $(elem).find("input[name='name']").val().indexOf("名字") != -1) {
        alert("请输入正确的姓名！");
        $(elem).find("input[name='name']").focus();
        $(elem).find("input[name='name']").val("");
        return false;
    }

    if (elem.mycall.value == "") {
        alert("请输入手机号码");
        elem.mycall.focus();
        return false;
    } else if (!(/^1[3-5|7-9][0-9]{9}$/.test(elem.mycall.value))) {
        alert("请输入正确的手机号码！");
        if (isNaN(elem.mycall.value))
            elem.mycall.value = "";
        elem.mycall.focus();
        return false;
    }
    // add("enews", "AddFeedback");
    add("title", (RegExp(/(.*?)(?=$|\-|_| )/g).exec($("title").text()))[0]);
    add("bid", (sdxh_formtoswt ? 3 : 2), true);
    add("llurl", window.location.href);
    add("qdurl", getCookie("sdxh_from_url"));
    add("ccurl", getCookie("sdxh_first_url"));

    $(elem).attr("accept-charset", "utf-8")
    $.ajax({
        type: "POST",
        url: "https://www.sdxhcc.com/e/tool/enrol/index.php",
        data: $(elem).serialize(),
        async: false,
        error: function (request) {
            alert("出现错误！");
        },
        success: function (data) {
            alert(data);
            // if (data == "提交成功")
            if (typeof (meteor) != "undefined")
                meteor.track("zxbm", {
                    convert_id: "1641651316393998"
                });
            if (sdxh_formtoswt) {
                var title = elem.title != undefined ? elem.title.value : "";
                var name = elem.name != undefined ? elem.name.value : "";
                var mycall = elem.mycall != undefined ? elem.mycall.value : "";
                var qq = elem.qq != undefined ? elem.qq.value : "";
                var saytext = elem.saytext != undefined ? elem.saytext.value : "";
                var zy = elem.zy != undefined ? elem.zy.value : "";
                sdxh_talk_mode_fun($('<a style="display:none" data-sdxh_talk_text="' + title + '-来自在线报名" data-sdxh_talk_alt="sdxh_talk_forminfo|姓名：' + name + '|电话：' + mycall + '|QQ：' + qq + '|专业：' + zy + '|备注：' + saytext + '">'));
            }
        }
    });
    return false;
}

function getDomain() {
    var sdxh_talk_domain = document.domain.split(".");
    var sdxh_talk_domain_needLength = 2;
    var sdxh_talk_domain_needString = "";
    if (sdxh_talk_domain.length <= sdxh_talk_domain_needLength)
        return sdxh_talk_domain;
    else {
        for (var i = 0; i < sdxh_talk_domain_needLength; i++)
            sdxh_talk_domain_needString = "." + sdxh_talk_domain[sdxh_talk_domain.length - i - 1] +
            sdxh_talk_domain_needString;
        return sdxh_talk_domain_needString;
    }
};

function setCookie(c_name, value, expiredays, path, domain) {
    if (expiredays != undefined) {
        var exdate = new Date()
        exdate.setDate(exdate.getDate() + expiredays);
    }
    document.cookie = ((c_name == undefined) ? "" : c_name) + "=" + ((value == undefined) ? "" : escape(value)) +
        ((exdate == undefined) ? "" : ";expires=" + exdate) +
        ((path == undefined) ? "" : ";path=" + path) +
        ((domain == undefined) ? "" : ";domain=" + domain);
}

function getCookie(name) {
    var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
    if (arr = document.cookie.match(reg))
        return unescape(arr[2]);
    else return null;
}

$(function () {
    var sdxh_bmbd = $("form[name='feedback']");
    sdxh_bmbd.submit(function () {
        return sdxh_formCheck(this)
    });
    sdxh_bmbd.find("select[name='zy']").each(function () {
        if ($(this).is(':hidden'))
            $(this).val("");
        else {
            $(this).find("*").remove()
            $(this).append(sdxh_proList.showOptionList());
        }
    });
    //配置初次来源链接
    if (getCookie("sdxh_from_url") == null) {
        setCookie("sdxh_from_url", document.referrer, 3650, '/', getDomain());
    }
    //配置初次访问链接
    if (getCookie("sdxh_first_url") == null) {
        setCookie("sdxh_first_url", location.href, 3650, '/', getDomain());
    }

    var lxb = {call: sdxh_freetel};//兼容离线宝
    sdxh_bmbd.find("[name='call']").attr("name", "mycall"); //兼容旧版call参数
    sdxh_bmbd.find("[name='bmtype']").attr("name", "title"); //兼容旧版bmtype参数
    sdxh_bmbd.find("[name='remark']").attr("name", "saytext"); //兼容旧版remark参数
});

// 铂金分析
window._pt_lt = new Date().getTime();
window._pt_sp_2 = [];
_pt_sp_2.push("setAccount,4d7a0fa7");
var _protocol = "https://";
(function () {
    var atag = document.createElement("script");
    atag.type = "text/javascript";
    atag.async = true;
    atag.src = _protocol + "js.ptengine.cn/4d7a0fa7.js";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(atag, s)
})();
